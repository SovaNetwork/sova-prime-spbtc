specVersion: 0.0.4
description: Multi-Collateral BTC Vault Subgraph
repository: https://github.com/SovaNetwork/multi-collateral-vault-subgraph
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum/contract
    name: MultiBTCVault
    network: mainnet # Change to sepolia for testnet
    source:
      address: "0x0000000000000000000000000000000000000000" # Replace with deployed vault address
      abi: MultiBTCVault
      startBlock: 18000000 # Replace with deployment block
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Vault
        - User
        - Deposit
        - Redemption
        - Transfer
        - DailySnapshot
      abis:
        - name: MultiBTCVault
          file: ./abis/MultiBTCVault.json
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: Deposit(indexed address,indexed address,uint256,uint256)
          handler: handleDeposit
        - event: Withdraw(indexed address,indexed address,indexed address,uint256,uint256)
          handler: handleWithdraw
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
        - event: RedemptionRequested(indexed uint256,indexed address,indexed address,uint256,uint256)
          handler: handleRedemptionRequested
      blockHandlers:
        - handler: handleBlock
          filter:
            kind: polling
            every: 100 # Every 100 blocks (~20 minutes)
      file: ./src/vault-mapping.ts

  - kind: ethereum/contract
    name: ManagedRedemptionQueue
    network: mainnet # Change to sepolia for testnet
    source:
      address: "0x0000000000000000000000000000000000000000" # Replace with deployed queue address
      abi: ManagedRedemptionQueue
      startBlock: 18000000 # Replace with deployment block
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - RedemptionRequest
        - ProcessedRedemption
        - QueueStats
      abis:
        - name: ManagedRedemptionQueue
          file: ./abis/ManagedRedemptionQueue.json
      eventHandlers:
        - event: RedemptionQueued(indexed uint256,indexed address,uint256,uint256)
          handler: handleRedemptionQueued
        - event: RedemptionProcessed(indexed uint256,indexed address,uint256,uint256)
          handler: handleRedemptionProcessed
        - event: ForceProcessed(indexed uint256,indexed address)
          handler: handleForceProcessed
      file: ./src/queue-mapping.ts

  - kind: ethereum/contract
    name: PriceOracleReporter
    network: mainnet # Change to sepolia for testnet
    source:
      address: "0x0000000000000000000000000000000000000000" # Replace with deployed oracle address
      abi: PriceOracleReporter
      startBlock: 18000000 # Replace with deployment block
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - PriceUpdate
        - NAVHistory
      abis:
        - name: PriceOracleReporter
          file: ./abis/PriceOracleReporter.json
      eventHandlers:
        - event: PriceUpdated(uint256,uint256,uint256)
          handler: handlePriceUpdated
      file: ./src/oracle-mapping.ts

  - kind: ethereum/contract
    name: MultiCollateralRegistry
    network: mainnet # Change to sepolia for testnet
    source:
      address: "0x0000000000000000000000000000000000000000" # Replace with deployed registry address
      abi: MultiCollateralRegistry
      startBlock: 18000000 # Replace with deployment block
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Collateral
        - CollateralConfig
      abis:
        - name: MultiCollateralRegistry
          file: ./abis/MultiCollateralRegistry.json
      eventHandlers:
        - event: CollateralAdded(indexed address,uint8,uint256)
          handler: handleCollateralAdded
        - event: CollateralRemoved(indexed address)
          handler: handleCollateralRemoved
        - event: CollateralUpdated(indexed address,uint256)
          handler: handleCollateralUpdated
      file: ./src/registry-mapping.ts

templates:
  - kind: ethereum/contract
    name: ERC20Token
    network: mainnet
    source:
      abi: ERC20
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.6
      language: wasm/assemblyscript
      entities:
        - Token
        - TokenBalance
      abis:
        - name: ERC20
          file: ./abis/ERC20.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTokenTransfer
        - event: Approval(indexed address,indexed address,uint256)
          handler: handleTokenApproval
      file: ./src/token-mapping.ts